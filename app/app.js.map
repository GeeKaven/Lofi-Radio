{"version":3,"sources":["../src/app.js"],"names":["app","bodyparser","use","join","__dirname","pathPrefix","extension","template","ctx","next","start","Date","ms","console","log","method","url","require","routes","status","render","on","err","port","parseInt","server","createServer","callback","listen","error","syscall","code","process","exit"],"mappings":"uSAAA,4B;AACA,0B;AACA,4B;AACA,qC;AACA,yC;AACA,mC;AACA,+C;AACA,uC;AACA,gD;AACA,yC;AACA,kC;;AAEA,IAAMA,MAAM,mBAAZ;AACA,IAAMC,aAAa,8BAAnB;;AAEA;AACAD,IAAIE,GAAJ,CAAQ,0BAAQD,UAAR,CAAR;AACAD,IAAIE,GAAJ,CAAQ,0BAAQ,wBAAR,CAAR;AACAF,IAAIE,GAAJ,CAAQ,0BAAQ,0BAAR,CAAR;;AAEA;AACAF,IAAIE,GAAJ,CAAQ,0BAAQ,6BAAU,eAAKC,IAAL,CAAUC,SAAV,EAAqB,WAArB,CAAV,EAA6C;AAC3DC,cAAY,EAD+C,EAA7C,CAAR,CAAR;;;AAIA;AACAL,IAAIE,GAAJ,CAAQ,wBAAM,eAAKC,IAAL,CAAUC,SAAV,EAAqB,UAArB,CAAN,EAAwC;AAC9CE,aAAW,KADmC,EAAxC,CAAR;;;AAIA;AACA,0BAAWN,GAAX,EAAgB;AACdO,YAAU,eADI,EAAhB;;;AAIA;AACAP,IAAIE,GAAJ,oFAAQ,iBAAOM,GAAP,EAAYC,IAAZ;AACAC,iBADA,GACQ,IAAIC,IAAJ,EADR;AAEAF,oBAFA;AAGAG,cAHA,GAGK,IAAID,IAAJ,KAAaD,KAHlB;AAING,oBAAQC,GAAR,CAAeN,IAAIO,MAAnB,SAA6BP,IAAIQ,GAAjC,WAA0CJ,EAA1C,SAJM,mEAAR;;;AAOA;AACAZ,IAAIE,GAAJ,qFAAQ,kBAAOM,GAAP,EAAYC,IAAZ;AACAQ,sBAAQ,UAAR,EAAoBC,MAApB,GAA6BV,GAA7B,EAAkCC,IAAlC,CADA,uEAAR;;;AAIA;AACAT,IAAIE,GAAJ,qFAAQ,kBAAOM,GAAP;AACNA,gBAAIW,MAAJ,GAAa,GAAb,CADM;AAEAX,kBAAIY,MAAJ,CAAW,KAAX,CAFA,uEAAR;;;AAKA;AACApB,IAAIqB,EAAJ,CAAO,OAAP,sFAAgB,kBAAOC,GAAP,EAAYd,GAAZ;AACdK,oBAAQC,GAAR,CAAY,gBAAZ,EAA8BQ,GAA9B,EADc,qEAAhB;;;AAIA,IAAMC,OAAOC,SAAS,iBAAOD,IAAP,IAAe,MAAxB,CAAb;AACA,IAAME,SAAS,eAAKC,YAAL,CAAkB1B,IAAI2B,QAAJ,EAAlB,CAAf;;AAEAF,OAAOG,MAAP,CAAcL,IAAd;AACAE,OAAOJ,EAAP,CAAU,OAAV,EAAmB,UAACQ,KAAD,EAAW;AAC5B,MAAIA,MAAMC,OAAN,KAAkB,QAAtB,EAAgC;AAC9B,UAAMD,KAAN;AACD;AACD;AACA,UAAQA,MAAME,IAAd;AACE,SAAK,QAAL;AACElB,cAAQgB,KAAR,CAAcN,OAAO,+BAArB;AACAS,cAAQC,IAAR,CAAa,CAAb;AACA;AACF,SAAK,YAAL;AACEpB,cAAQgB,KAAR,CAAcN,OAAO,oBAArB;AACAS,cAAQC,IAAR,CAAa,CAAb;AACA;AACF;AACE,YAAMJ,KAAN,CAVJ;;AAYD,CAjBD;AAkBAJ,OAAOJ,EAAP,CAAU,WAAV,EAAuB,YAAM;AAC3BR,UAAQC,GAAR,CAAY,uBAAZ,EAAqCS,IAArC;AACD,CAFD,E;;AAIevB,G","file":"app.js","sourcesContent":["import http from 'http'\nimport Koa from 'koa'\nimport path from 'path'\nimport views from 'koa-views'\nimport convert from 'koa-convert'\nimport json from 'koa-json'\nimport Bodyparser from 'koa-bodyparser'\nimport logger from 'koa-logger'\nimport koaStatic from 'koa-static-plus'\nimport koaOnError from 'koa-onerror'\nimport config from './config'\n\nconst app = new Koa()\nconst bodyparser = Bodyparser()\n\n// middlewares\napp.use(convert(bodyparser))\napp.use(convert(json()))\napp.use(convert(logger()))\n\n// static\napp.use(convert(koaStatic(path.join(__dirname, '../public'), {\n  pathPrefix: ''\n})))\n\n// views\napp.use(views(path.join(__dirname, '../views'), {\n  extension: 'ejs'\n}))\n\n// 500 error\nkoaOnError(app, {\n  template: 'views/500.ejs'\n})\n\n// logger\napp.use(async (ctx, next) => {\n  const start = new Date()\n  await next()\n  const ms = new Date() - start\n  console.log(`${ctx.method} ${ctx.url} - ${ms}ms`)\n})\n\n// response router\napp.use(async (ctx, next) => {\n  await require('./routes').routes()(ctx, next)\n})\n\n// 404\napp.use(async (ctx) => {\n  ctx.status = 404\n  await ctx.render('404')\n})\n\n// error logger\napp.on('error', async (err, ctx) => {\n  console.log('error occured:', err)\n})\n\nconst port = parseInt(config.port || '3000')\nconst server = http.createServer(app.callback())\n\nserver.listen(port)\nserver.on('error', (error) => {\n  if (error.syscall !== 'listen') {\n    throw error\n  }\n  // handle specific listen errors with friendly messages\n  switch (error.code) {\n    case 'EACCES':\n      console.error(port + ' requires elevated privileges')\n      process.exit(1)\n      break\n    case 'EADDRINUSE':\n      console.error(port + ' is already in use')\n      process.exit(1)\n      break\n    default:\n      throw error\n  }\n})\nserver.on('listening', () => {\n  console.log('Listening on port: %d', port)\n})\n\nexport default app\n"]}